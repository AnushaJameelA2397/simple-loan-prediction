{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "6bbb39a0-1f76-4223-800e-8643fbed4f1b",
   "metadata": {},
   "outputs": [
    {
     "name": "stderr",
     "output_type": "stream",
     "text": [
      "2025-04-20 15:51:14.056 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.060 WARNING streamlit.runtime.scriptrunner_utils.script_run_context: Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.398 \n",
      "  \u001b[33m\u001b[1mWarning:\u001b[0m to view this Streamlit app on a browser, run it with the following\n",
      "  command:\n",
      "\n",
      "    streamlit run C:\\Users\\Anusha\\AppData\\Local\\Programs\\Python\\Python313\\Lib\\site-packages\\ipykernel_launcher.py [ARGUMENTS]\n",
      "2025-04-20 15:51:14.399 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.400 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.401 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.403 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.404 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.405 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.407 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.409 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.410 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.411 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.412 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.414 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.416 Session state does not function when running a script without `streamlit run`\n",
      "2025-04-20 15:51:14.417 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.418 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.419 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.420 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.422 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.423 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.424 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.425 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.426 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.427 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.428 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.429 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.430 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.430 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.431 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.432 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.433 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.433 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.434 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.435 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.436 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.437 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.438 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.439 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.439 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.440 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.441 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.442 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.443 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.445 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.446 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.447 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.448 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.449 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.450 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.452 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.453 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.453 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.455 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.456 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.457 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.458 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.459 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.460 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.461 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.462 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.463 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.464 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.466 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.467 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.469 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.470 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.472 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n",
      "2025-04-20 15:51:14.473 Thread 'MainThread': missing ScriptRunContext! This warning can be ignored when running in bare mode.\n"
     ]
    }
   ],
   "source": [
    "import streamlit as st\n",
    "import mysql.connector\n",
    "from mysql.connector import Error\n",
    "\n",
    "# Set page config\n",
    "st.set_page_config(page_title=\"Loan Eligibility System\", page_icon=\"üè¶\", layout=\"wide\")\n",
    "\n",
    "# Database connection function\n",
    "def get_db_connection():\n",
    "    try:\n",
    "        connection = mysql.connector.connect(\n",
    "            host='localhost',\n",
    "            database='LoanEligibilitySystem',\n",
    "            user='root',\n",
    "            password='Anusha@95245'\n",
    "        )\n",
    "        return connection\n",
    "    except Error as e:\n",
    "        st.error(f\"Database connection error: {e}\")\n",
    "        return None\n",
    "\n",
    "# Check eligibility function (same as your original)\n",
    "def check_eligibility(customer_data):\n",
    "    eligible = True\n",
    "    reasons = []\n",
    "    \n",
    "    # Rule 1: Age must be between 21 and 65\n",
    "    if customer_data['age'] < 21 or customer_data['age'] > 65:\n",
    "        eligible = False\n",
    "        reasons.append(\"Age must be between 21 and 65\")\n",
    "    \n",
    "    # Rule 2: Minimum credit score of 600\n",
    "    if customer_data['credit_score'] < 600:\n",
    "        eligible = False\n",
    "        reasons.append(\"Minimum credit score of 600 required\")\n",
    "    \n",
    "    # Rule 3: Debt-to-income ratio less than 40%\n",
    "    total_debt = customer_data['existing_debt'] + (customer_data['loan_amount'] / customer_data['loan_term'])\n",
    "    debt_to_income = (total_debt / customer_data['income']) * 100\n",
    "    if debt_to_income > 40:\n",
    "        eligible = False\n",
    "        reasons.append(f\"Debt-to-income ratio {debt_to_income:.2f}% exceeds 40% limit\")\n",
    "    \n",
    "    # Rule 4: Must be employed\n",
    "    if customer_data['employment_status'].lower() in ['unemployed', 'student']:\n",
    "        eligible = False\n",
    "        reasons.append(\"Must be employed or self-employed\")\n",
    "    \n",
    "    # Rule 5: Minimum income requirement based on loan amount\n",
    "    if customer_data['loan_amount'] > 50000 and customer_data['income'] < 5000:\n",
    "        eligible = False\n",
    "        reasons.append(\"Income too low for requested loan amount\")\n",
    "    \n",
    "    return eligible, reasons\n",
    "\n",
    "# Save to database function\n",
    "def save_customer_data(customer_data, is_eligible, reasons):\n",
    "    connection = get_db_connection()\n",
    "    if not connection:\n",
    "        return\n",
    "        \n",
    "    try:\n",
    "        cursor = connection.cursor()\n",
    "        query = \"\"\"\n",
    "        INSERT INTO Customers \n",
    "        (Name, Age, Gender, Income, CreditScore, LoanAmount, LoanTerm, ExistingDebt, EmploymentStatus, EligibilityStatus)\n",
    "        VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s)\n",
    "        \"\"\"\n",
    "        \n",
    "        eligibility_status = \"Approved\" if is_eligible else \"Denied\"\n",
    "        \n",
    "        cursor.execute(query, (\n",
    "            customer_data['name'],\n",
    "            customer_data['age'],\n",
    "            customer_data['gender'],\n",
    "            customer_data['income'],\n",
    "            customer_data['credit_score'],\n",
    "            customer_data['loan_amount'],\n",
    "            customer_data['loan_term'],\n",
    "            customer_data['existing_debt'],\n",
    "            customer_data['employment_status'],\n",
    "            eligibility_status\n",
    "        ))\n",
    "        \n",
    "        connection.commit()\n",
    "        st.success(\"Your application has been recorded.\")\n",
    "        \n",
    "    except Error as e:\n",
    "        st.error(f\"Error saving customer data: {e}\")\n",
    "    finally:\n",
    "        if connection.is_connected():\n",
    "            connection.close()\n",
    "\n",
    "# Main app function\n",
    "def main():\n",
    "    st.title(\"üè¶ Loan Eligibility System\")\n",
    "    st.markdown(\"Complete the form below to check your loan eligibility\")\n",
    "    \n",
    "    with st.form(\"loan_form\"):\n",
    "        col1, col2 = st.columns(2)\n",
    "        \n",
    "        with col1:\n",
    "            name = st.text_input(\"Full Name\")\n",
    "            age = st.number_input(\"Age\", min_value=18, max_value=100, step=1)\n",
    "            gender = st.selectbox(\"Gender\", [\"Male\", \"Female\", \"Other\"])\n",
    "            income = st.number_input(\"Monthly Income \", min_value=0, step=100)\n",
    "            credit_score = st.slider(\"Credit Score\", 300, 850, 650)\n",
    "            \n",
    "        with col2:\n",
    "            loan_amount = st.number_input(\"Desired Loan Amount \", min_value=0, step=1000)\n",
    "            loan_term = st.selectbox(\"Loan Term (months)\", [12, 24, 36, 60])\n",
    "            existing_debt = st.number_input(\"Existing Monthly EMI Payments \", min_value=0, step=100)\n",
    "            employment_status = st.selectbox(\n",
    "                \"Employment Status\",\n",
    "                [\"Employed\", \"Self-Employed\", \"Unemployed\", \"Student\"]\n",
    "            )\n",
    "        \n",
    "        submitted = st.form_submit_button(\"Check Eligibility\")\n",
    "        \n",
    "        if submitted:\n",
    "            if not all([name, age, income, credit_score, loan_amount, existing_debt]):\n",
    "                st.warning(\"Please fill all required fields\")\n",
    "            else:\n",
    "                customer_data = {\n",
    "                    'name': name,\n",
    "                    'age': age,\n",
    "                    'gender': gender,\n",
    "                    'income': income,\n",
    "                    'credit_score': credit_score,\n",
    "                    'loan_amount': loan_amount,\n",
    "                    'loan_term': loan_term,\n",
    "                    'existing_debt': existing_debt,\n",
    "                    'employment_status': employment_status\n",
    "                }\n",
    "                \n",
    "                is_eligible, reasons = check_eligibility(customer_data)\n",
    "                save_customer_data(customer_data, is_eligible, reasons)\n",
    "                \n",
    "                st.divider()\n",
    "                if is_eligible:\n",
    "                    st.balloons()\n",
    "                    st.success(\"## üéâ CONGRATULATIONS!\")\n",
    "                    st.success(\"Based on the information provided, you are **ELIGIBLE** for the loan.\")\n",
    "                else:\n",
    "                    st.error(\"## üòî SORRY!\")\n",
    "                    st.error(\"Based on the information provided, you are **NOT ELIGIBLE** for the loan.\")\n",
    "                    st.warning(\"**Reasons:**\")\n",
    "                    for reason in reasons:\n",
    "                        st.write(f\"- {reason}\")\n",
    "\n",
    "if __name__ == \"__main__\":\n",
    "    main()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "80068159-7831-48f2-9819-8507674ef8da",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.13.2"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
